<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronicle Builder - Choice Chronicles</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .back-btn, .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
            color: white;
        }

        .back-btn:hover, .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        body.dark-mode .container {
            background: #0f3460;
        }

        .game-content {
            padding: 40px;
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }

        .title {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        body.dark-mode .title {
            color: #e0e0e0;
        }

        .api-status {
            background: #e8f4f8;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            color: #0066cc;
            margin-bottom: 15px;
            text-align: center;
        }

        body.dark-mode .api-status {
            background: #1a2a3a;
            color: #7db8ff;
        }

        .timeline-display {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            min-height: 120px;
        }

        body.dark-mode .timeline-display {
            background: #1a1a2e;
        }

        .era-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .era-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        body.dark-mode .era-item {
            background: #16213e;
            color: #e0e0e0;
        }

        .era-label {
            color: #999;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        body.dark-mode .era-label {
            color: #7db8ff;
        }

        .era-value {
            color: #333;
            font-size: 1.1em;
            font-weight: bold;
        }

        body.dark-mode .era-value {
            color: #fff;
        }

        .event-display {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid #667eea;
            min-height: 150px;
        }

        body.dark-mode .event-display {
            background: #16213e;
            border-color: #9fb3ff;
        }

        .event-title {
            color: #667eea;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        body.dark-mode .event-title {
            color: #9fb3ff;
        }

        .event-description {
            color: #555;
            line-height: 1.8;
            font-size: 1.05em;
        }

        body.dark-mode .event-description {
            color: #b0b0b0;
        }

        .consequences {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            color: #664d03;
            border-left: 4px solid #ffc107;
        }

        body.dark-mode .consequences {
            background: #4a3900;
            color: #ffc107;
        }

        .choices-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .choice-btn {
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-align: left;
        }

        .choice-btn:hover {
            background: #764ba2;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: auto;
        }

        .btn {
            flex: 1;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .btn.secondary {
            background: #6c757d;
        }

        .btn.secondary:hover {
            background: #5a6268;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        body.dark-mode .stat-box {
            background: #1a1a2e;
        }

        .stat-value {
            color: #667eea;
            font-size: 1.5em;
            font-weight: bold;
        }

        body.dark-mode .stat-value {
            color: #9fb3ff;
        }

        .stat-label {
            color: #999;
            font-size: 0.9em;
            margin-top: 5px;
        }

        body.dark-mode .stat-label {
            color: #7db8ff;
        }

        .history-timeline {
            margin-top: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        body.dark-mode .history-timeline {
            background: #1a1a2e;
        }

        .timeline-event {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #667eea;
            color: #555;
            font-size: 0.95em;
        }

        body.dark-mode .timeline-event {
            background: #16213e;
            color: #b0b0b0;
        }

        .intro-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .intro-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
        }

        body.dark-mode .intro-content {
            background: #0f3460;
            color: #e0e0e0;
        }

        .intro-content h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2em;
        }

        body.dark-mode .intro-content h2 {
            color: #9fb3ff;
        }

        .intro-content p {
            color: #555;
            line-height: 1.8;
            margin-bottom: 15px;
            font-size: 1.05em;
        }

        body.dark-mode .intro-content p {
            color: #b0b0b0;
        }

        .intro-content .highlight {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        body.dark-mode .intro-content .highlight {
            background: #1a2a3a;
            border-color: #9fb3ff;
        }

        .intro-content ul {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        .intro-content li {
            color: #555;
            margin-bottom: 10px;
        }

        body.dark-mode .intro-content li {
            color: #b0b0b0;
        }

        .start-btn {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 20px;
        }

        .start-btn:hover {
            background: #764ba2;
        }

        @media (max-width: 768px) {
            .game-content {
                padding: 20px;
            }

            .title {
                font-size: 1.8em;
            }

            .era-info {
                grid-template-columns: 1fr;
            }

            .choices-grid {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .action-buttons {
                flex-direction: column;
            }

            .intro-content {
                padding: 25px;
            }

            .intro-content h2 {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <!-- Introduction Modal -->
    <div class="intro-modal" id="introModal">
        <div class="intro-content">
            <h2>üìñ Welcome to Chronicle Builder</h2>
            <p><strong>What is Chronicle Builder?</strong></p>
            <p>You are a time-traveling historian with the power to influence major decisions throughout history. Each choice you make ripples through time, shaping civilizations and changing the course of human events.</p>
            
            <div class="highlight">
                <strong>üéØ Your Mission:</strong>
                <ul>
                    <li>Travel through 13 different historical eras</li>
                    <li>Face critical decisions that shaped our world</li>
                    <li>See how your choices impact history (0-100%)</li>
                    <li>Build your own alternate timeline</li>
                </ul>
            </div>

            <p><strong>How it works:</strong></p>
            <p>‚Ä¢ Manage 4 critical attributes: Stability, Innovation, Culture, and Economy (all start at 50)<br>
            ‚Ä¢ Each decision affects these attributes differently<br>
            ‚Ä¢ Future events adapt based on your current state<br>
            ‚Ä¢ Survive 10 turns without any attribute reaching 0<br>
            ‚Ä¢ Achieve victory by maintaining balance OR dominating specific attributes<br>
            ‚Ä¢ Your final choices create a unique future timeline!</p>

            <div class="highlight">
                <strong>‚ö†Ô∏è Warning:</strong> If any attribute drops to 0, your civilization collapses! Balance is key, but specialization can lead to unique victories.
            </div>

            <p style="text-align: center; margin-top: 25px; font-size: 1.1em;"><strong>Can you lead your civilization to greatness?</strong></p>
            
            <button class="start-btn" onclick="startGame()">üöÄ Begin Your Journey</button>
        </div>
    </div>

    <div class="header-bar">
        <button class="back-btn" onclick="goBack()" title="Back to Hub">‚Üê</button>
        <h1 style="color: white; flex: 1; text-align: center; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">üìñ Chronicle Builder</h1>
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">üåô</button>
    </div>

    <div class="container">
        <div class="game-content">
            <!-- API Status -->
            <div class="api-status" id="apiStatus">üîÑ Loading from APIs...</div>

            <!-- Statistics -->
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="stabilityDisplay">50</div>
                    <div class="stat-label">‚öñÔ∏è Stability</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="innovationDisplay">50</div>
                    <div class="stat-label">‚ö° Innovation</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="cultureDisplay">50</div>
                    <div class="stat-label">üé≠ Culture</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="economyDisplay">50</div>
                    <div class="stat-label">üí∞ Economy</div>
                </div>
            </div>
            
            <!-- Progress Bar -->
            <div style="background: #e0e0e0; border-radius: 10px; height: 30px; margin-bottom: 20px; overflow: hidden;">
                <div id="progressBar" style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; width: 0%; transition: width 0.5s; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                    Turn 0/10
                </div>
            </div>

            <!-- Timeline Era Information -->
            <div class="timeline-display">
                <div class="era-info">
                    <div class="era-item">
                        <div class="era-label">‚è∞ Historical Period</div>
                        <div class="era-value" id="periodDisplay">Loading...</div>
                    </div>
                    <div class="era-item">
                        <div class="era-label">üåç Location</div>
                        <div class="era-value" id="locationDisplay">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Event Display -->
            <div class="event-display">
                <div class="event-title" id="eventTitle">üìú Historical Crossroads</div>
                <div class="event-description" id="eventDescription">Loading event...</div>
                <div class="consequences" id="consequences" style="display: none;"></div>
            </div>

            <!-- Choices -->
            <div style="margin-bottom: 20px;">
                <h3 style="color: #333; margin-bottom: 15px;" id="choicePrompt">ü§î What will you do?</h3>
                <div class="choices-grid" id="choicesContainer">
                    <div style="text-align: center; color: #999;">Loading choices...</div>
                </div>
            </div>

            <!-- History Timeline -->
            <div class="history-timeline" id="historyTimeline">
                <div style="text-align: center; color: #999;">Your decisions will appear here...</div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn secondary" onclick="resetGame()">Reset Game</button>
                <button class="btn" onclick="shareStory()">Share Story</button>
            </div>
        </div>
    </div>

    <script>
        // Style for dark mode choice prompt
        const style = document.createElement('style');
        style.textContent = 'body.dark-mode #choicePrompt { color: #e0e0e0; }';
        document.head.appendChild(style);

        // Start game function
        function startGame() {
            document.getElementById('introModal').style.display = 'none';
            displayEvent();
        }

        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('dark-mode', isDark);
            document.querySelector('.theme-toggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        }

        if (localStorage.getItem('dark-mode') === 'true') {
            document.body.classList.add('dark-mode');
            document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
        }

        function goBack() {
            window.location.href = 'index.html';
        }turn: 0,
            maxTurns: 10,
            stability: 50,
            innovation: 50,
            culture: 50,
            economy: 50,
            decisions: [],
            currentEvent: null,
            gameOver: false
            currentYear: 2024,
            era: 'Modern',
            choicesMade: 0,
            historyChanged: 0,
            decisions: [],
            currentEvent: null
        };

        // Historical Periods with API topics
        const eras = [
            { name: 'Ancient Egypt', year: 1500, period: '3000 BCE - 30 BCE', wikiTopic: 'Ancient Egypt' },
            { name: 'Classical Greece', year: 1, period: '800 BCE - 146 BCE', wikiTopic: 'Ancient Greece' },
            { name: 'Roman Empire', year: 100, period: '27 BCE - 476 CE', wikiTopic: 'Roman Empire' },
            { name: 'Medieval Times', year: 1000, period: '500 CE - 1500 CE', wikiTopic: 'Middle Ages' },
            { name: 'Renaissance', year: 1400, period: '1300 - 1600', wikiTopic: 'Renaissance' },
            { name: 'Age of Exploration', year: 1500, period: '1400 - 1700', wikiTopic: 'Age of Exploration' },
            { name: 'Industrial Revolution', year: 1750, period: '1760 - 1840', wikiTopic: 'Industrial Revolution' },
            { name: 'Victorian Era', year: 1850, period: '1837 - 1901', wikiTopic: 'Victorian era' },
            { name: 'Roaring Twenties', year: 1920, period: '1920 - 1929', wikiTopic: 'Roaring Twenties' },
            { name: 'World War II', year: 1940, period: '1939 - 1945', wikiTopic: 'World War II' },
            { name: 'Cold War', year: 1960, period: '1945 - 1991', wikiTopic: 'Cold War' },
            { name: 'Digital Age', year: 2000, period: '2000 - Present', wikiTopic: 'Digital Revolution' },
            { name: 'Modern Era', year: 2024, period: '2020 - Present', wikiTopic: 'Information Age' }
        ];

        // API Functions
        async function fetchWikipediaSummary(topic) {
            try {
                const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(topic)}`);
                if (!response.ok) throw new Error('Wikipedia fetch failed');
                const data = await response.json();
                return data.extract || null;
            } catch (error) {
                console.log('Wikipedia API unavailable');
                return null;
            }
        }

        async function fetchHistoricalQuote() {
            try {
                // Try ZenQuotes API first
                const response = await fetch('https://zenquotes.io/api/random');
                if (!response.ok) throw new Error('ZenQuotes failed');
                const data = await response.json();
                if (data && data[0]) {
                    return `"${data[0].q}" - ${data[0].a}`;
                }
            } catch (error) {
                console.log('ZenQuotes unavailable, trying Advice Slip...');
            }
            
            try {
                // Fallback to Advice Slip API
                const response = await fetch('https://api.adviceslip.com/advice');
                if (!response.ok) throw new Error('Advice Slip failed');
                const data = await response.json();
                if (data && data.slip) {
                    return `"${data.slip.advice}" - Wisdom`;
                }
            } catch (error) {
                console.log('Advice Slip unavailable, trying Game of Thrones...');
            }

            try {
                // Fallback to Game of Thrones Quotes API
                const response = await fetch('https://api.gameofthronesquotes.xyz/v1/random');
                if (!response.ok) throw new Error('GOT Quotes failed');
                const data = await response.json();
                if (data && data.sentence) {
                    return `"${data.sentence}" - ${data.character.name}`;
                }
            } catch (error) {
                console.log('All quote APIs unavailable');
                return null;
            }
        }

        async function fetchHistoricalEvent() {
            try {
                const response = await fetch('https://history.muffinlabs.com/date');
                if (!response.ok) throw new Error('History API failed');
                const data = await response.json();
        // Dynamic event templates based on current state
        function getEventTemplates(era) {
            const templates = [];
            
            // Crisis events triggered by low stats
            if (gameState.stability < 30) {
                templates.push({
                    title: `üî• ${era.name}: Civil Unrest Erupts`,
                    situation: 'Riots sweep through major cities. Order is collapsing.',
                    choices: [
                        { text: '‚öîÔ∏è Military crackdown', effects: { stability: 15, innovation: -10, culture: -15, economy: -5 } },
                        { text: 'ü§ù Negotiate with protesters', effects: { stability: 5, innovation: 5, culture: 10, economy: -10 } },
                        { text: 'üí∞ Economic relief programs', effects: { stability: 10, innovation: -5, culture: 5, economy: -15 } }
                    ]
                });
            }
            
            if (gameState.economy < 30) {
                templates.push({
                    title: `üí∏ ${era.name}: Economic Collapse Looms`,
                    situation: 'Markets crash. Unemployment soars. The treasury is empty.',
                    choices: [
                        { text: 'üè¶ Emergency loans from neighbors', effects: { stability: -10, innovation: 0, culture: -5, economy: 20 } },
                        { text: '‚öôÔ∏è Industrialize rapidly', effects: { stability: -5, innovation: 15, culture: -10, economy: 15 } },
                        { text: 'üåæ Return to agrarian roots', effects: { stability: 10, innovation: -15, culture: 5, economy: 10 } }
                    ]
                });
            }
            
            if (gameState.innovation < 30) {
                templates.push({
                    title: `üìâ ${era.name}: Falling Behind the Times`,
                    situation: 'Neighboring civilizations surge ahead while yours stagnates.',
                    choices: [
                        { text: 'üéì Found universities and research centers', effects: { stability: -5, innovation: 20, culture: 10, economy: -10 } },
                        { text: 'üïµÔ∏è Steal foreign technology', effects: { stability: -10, innovation: 15, culture: -5, economy: 5 } },
                        { text: 'üö´ Reject foreign influence', effects: { stability: 15, innovation: -10, culture: 15, economy: -5 } }
                    ]
                });
            }
            
            if (gameState.culture < 30) {
                templates.push({
                    title: `üé≠ ${era.name}: Cultural Identity Crisis`,
                    situation: 'Traditional values erode. Your people forget who they are.',
                    choices: [
                        { text: 'üìö Preserve ancient texts and traditions', effects: { stability: 10, innovation: -10, culture: 20, economy: -5 } },
                        { text: 'üåç Embrace multiculturalism', effects: { stability: -5, innovation: 10, culture: 15, economy: 10 } },
                        { text: 'üé® State-sponsored cultural renaissance', effects: { stability: 5, innovation: 5, culture: 20, economy: -15 } }
                    ]
                });
            }
            if (gameState.gameOver) return;
            
            const era = eras[Math.min(gameState.turn, eras.length - 1)];
            const event = await generateEvent(era);

            gameState.currentYear = era.year;
            gameState.era = era.name;
            gameState.currentEvent = event;

            document.getElementById('apiStatus').textContent = '‚úÖ Real data from Wikipedia, ZenQuotes & History APIs';
            document.getElementById('periodDisplay').textContent = era.period;
            document.getElementById('locationDisplay').textContent = era.name;
            document.getElementById('eventTitle').textContent = event.title;
            document.getElementById('eventDescription').textContent = event.description;
            document.getElementById('consequences').style.display = 'none';

            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            event.choices.forEach((choice) => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                const effectsText = Object.entries(choice.effects)
                    .map(([stat, val]) => `${stat.charAt(0).toUpperCase() + stat.slice(1)} ${val > 0 ? '+' : ''}${val}`)
                    .join(', ');
                btn.innerHTML = `<strong>${choice.text}</strong><br><span style="font-size: 0.85em; opacity: 0.9;">üìä ${effectsText}</span>`;
                btn.onclick = () => makeChoice(choice);
                choicesContainer.appendChild(btn);
            });updateStats() {
            document.getElementById('stabilityDisplay').textContent = gameState.stability;
            document.getElementById('innovationDisplay').textContent = gameState.innovation;
            document.getElementById('cultureDisplay').textContent = gameState.culture;
            document.getElementById('economyDisplay').textContent = gameState.economy;
            
            const progress = (gameState.turn / gameState.maxTurns) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressBar').textContent = `Turn ${gameState.turn}/${gameState.maxTurns}`;
            
            // Color code stats
            ['stability', 'innovation', 'culture', 'economy'].forEach(stat => {
                const elem = document.getElementById(stat + 'Display');
                const val = gameState[stat];
                if (val < 20) elem.style.color = '#ff4444';
                else if (val < 40) elem.style.color = '#ff9944';
                else if (val > 70) elem.style.color = '#44ff44';
                else elem.style.color = '#667eea';
            });
        }

        function makeChoice(choice) {
            gameState.turn++;
            
            // Apply effects
            Object.entries(choice.effects).forEach(([stat, value]) => {
                gameState[stat] = Math.max(0, Math.min(100, gameState[stat] + value));
            });
            
            gameState.decisions.push({
                era: gameState.era,
                year: gameState.currentYear,
                choice: choice.text,
                effects: choice.effects
            });

            updateStats();

            const consequencesDiv = document.getElementById('consequences');
            let impactMessage = `‚ö° <strong>Consequences:</strong><br>`;
            , i) => {
                const effectsText = Object.entries(d.effects)
                    .map(([stat, val]) => `${stat.substring(0, 3)}: ${val > 0 ? '+' : ''}${val}`)
                    .join(', ');
                return `
                    <div class="timeline-event">
                        <strong>Turn ${i + 1}: ${d.era} (${d.year})</strong><br>
                        ${d.choice}<br>
                        <em style="font-size: 0.9em;">üìä ${effectsText}</em>
                    </div>
                `;
            }).reverse().join('');
        }

        function shareStory() {
            const { stability, innovation, culture, economy } = gameState;
            const total = stability + innovation + culture + economy;
            const text = `üé≠ Chronicle Builder Results:\n\nSurvived ${gameState.turn} turns!\nFinal Stats:\n‚öñÔ∏è Stability: ${stability}\n‚ö° Innovation: ${innovation}\nüé≠ Culture: ${culture}\nüí∞ Economy: ${economy}\nüìä Total Score: ${total}/400\n\n${gameState.decisions.map((d, i) => `Turn ${i+1} (${d.era}): ${d.choice}`).join('\n')}`;
            navigator.clipboard.writeText(text).then(() => alert('‚úÖ Story copied to clipboard!')).catch(() => alert('‚ùå Failed to copy'));
        }

        function resetGame() {
            gameState = {
                currentYear: 2024,
                era: 'Modern',
                turn: 0,
                maxTurns: 10,
                stability: 50,
                innovation: 50,
                culture: 50,
                economy: 50,
                decisions: [],
                currentEvent: null,
                gameOver: false
            };
            document.getElementById('historyTimeline').innerHTML = '<div style="text-align: center; color: #999;">Your decisions will appear here...</div>';
            document.getElementById('consequences').style.display = 'none';
            updateStats()
                gameState.gameOver = true;
                impactMessage += '<br><br>üéä <strong>SURVIVED!</strong> You\'ve guided your civilization through 10 critical decisions. Generating your future...';
                consequencesDiv.innerHTML = impactMessage;
                consequencesDiv.style.display = 'block';
                setTimeout(() => endGame(true), 3000);
                return;
            }
            
            consequencesDiv.innerHTML = impactMessage;
            consequencesDiv.style.display = 'block';

            updateHistoryTimeline();
            setTimeout(() => displayEvent(), 3500);
        }
        
        function endGame(victory) {
            const eventTitle = document.getElementById('eventTitle');
            const eventDesc = document.getElementById('eventDescription');
            const choicesContainer = document.getElementById('choicesContainer');
            const consequences = document.getElementById('consequences');
            
            if (!victory) {
                eventTitle.textContent = 'üíÄ Civilization Collapsed';
                eventDesc.textContent = 'Your civilization crumbled under the weight of its failures. The decisions you made led to ruin, and your people are scattered to the winds of history.';
                consequences.innerHTML = '<strong>‚ò†Ô∏è DEFEAT:</strong> Game Over. Try again and balance your attributes better!';
                consequences.style.display = 'block';
                choicesContainer.innerHTML = '<button class="choice-btn" onclick="resetGame()">üîÑ Try Again</button>';
                return;
            }
            
            // Generate unique future based on stats
            const { stability, innovation, culture, economy } = gameState;
            const total = stability + innovation + culture + economy;
            const dominant = Math.max(stability, innovation, culture, economy);
            
            let futureTitle = '';
            let futureDesc = '';
            let rating = '';
            
            // Perfect balance victory
            if (Math.abs(stability - innovation) < 15 && Math.abs(culture - economy) < 15 && total > 250) {
                futureTitle = '‚≠ê THE PERFECT CIVILIZATION';
                futureDesc = 'Through masterful leadership, you\'ve created a harmonious society where stability, innovation, culture, and economy all thrive in perfect balance. Your civilization becomes a beacon of hope for all humanity, achieving levels of prosperity and happiness never before seen. Historians will study your reign for millennia as the pinnacle of human achievement.';
                rating = 'S-TIER VICTORY';
            }
            // Innovation dominance
            else if (innovation === dominant && innovation > 70) {
                futureTitle = 'üöÄ THE TECHNO-UTOPIA';
                futureDesc = `Your relentless pursuit of innovation (${innovation}) has launched humanity into a new golden age of technology. Flying cities, AI governance, and space colonies define your civilization. However, ${stability < 40 ? 'social instability' : culture < 40 ? 'cultural erosion' : 'economic inequality'} remains a challenge in this brave new world.`;
                rating = innovation > 85 ? 'A-TIER VICTORY' : 'B-TIER VICTORY';
            }
            // Culture dominance
            else if (culture === dominant && culture > 70) {
                futureTitle = 'üé≠ THE CULTURAL RENAISSANCE';
                futureDesc = `Your dedication to culture (${culture}) has created an artistic paradise where philosophy, art, and tradition flourish. Your civilization's music, literature, and wisdom spread across the globe. Yet, ${innovation < 40 ? 'technological stagnation' : economy < 40 ? 'economic struggles' : 'external threats'} loom on the horizon.`;
                rating = culture > 85 ? 'A-TIER VICTORY' : 'B-TIER VICTORY';
            }
            // Economy dominance
            else if (economy === dominant && economy > 70) {
                futureTitle = 'üíé THE GOLDEN EMPIRE';
                futureDesc = `Your economic mastery (${economy}) has built the wealthiest civilization in history. Trade networks span the globe, prosperity is abundant, and your treasury overflows. But ${stability < 40 ? 'inequality breeds unrest' : culture < 40 ? 'materialism erodes meaning' : 'innovation lags behind'} in this age of gold.`;
                rating = economy > 85 ? 'A-TIER VICTORY' : 'B-TIER VICTORY';
            }
            // Stability dominance
            else if (stability === dominant && stability > 70) {
                futureTitle = 'üèõÔ∏è THE ETERNAL ORDER';
                futureDesc = `Your focus on stability (${stability}) has created an enduring civilization of law, order, and peace. Crime is nearly extinct, institutions are unshakeable, and your people live in security. However, ${innovation < 40 ? 'progress has stalled' : culture < 40 ? 'conformity stifles creativity' : 'economic dynamism suffers'} under this rigid order.`;
                rating = stability > 85 ? 'A-TIER VICTORY' : 'B-TIER VICTORY';
            }
            // Balanced but weak
            else if (total < 180) {
                futureTitle = '‚ö†Ô∏è THE STRUGGLING STATE';
                futureDesc = 'Your civilization survives, but barely. All attributes remain weak, and your people face daily hardships. While you avoided total collapse, mediocrity defines your legacy. Future generations will remember this era as a time of missed opportunities and cautious leadership.';
                rating = 'C-TIER VICTORY';
            }
            // Moderate success
            else {
                futureTitle = 'üåü THE STABLE CIVILIZATION';
                futureDesc = `Your balanced approach has created a functional, if unspectacular, civilization. With moderate scores across all attributes (Total: ${total}), your people enjoy reasonable prosperity and stability. History will remember you as a competent leader who kept the ship afloat through troubled waters.`;
                rating = 'B-TIER VICTORY';
            }
            
            eventTitle.textContent = `üéä ${futureTitle}`;
            eventDesc.textContent = futureDesc;
            consequences.innerHTML = `<strong>üèÜ ${rating}</strong><br><br>Final Stats: Stability ${stability} | Innovation ${innovation} | Culture ${culture} | Economy ${economy}<br>Total Score: ${total}/400`;
            consequences.style.display = 'block';
            choicesContainer.innerHTML = `
                <button class="choice-btn" onclick="resetGame()">üîÑ Play Again</button>
                <button class="choice-btn" onclick="shareStory()">üì§ Share Result</button>
            `endence', effects: { stability: -10, innovation: -5, culture: 20, economy: -15 } }
                    ]
                },
                {
                    title: `üìú ${era.name}: Revolutionary Ideas Emerge`,
                    situation: 'Radical thinkers challenge the status quo. Allow them to speak?',
                    choices: [
                        { text: 'üì¢ Champion free expression', effects: { stability: -15, innovation: 20, culture: 15, economy: -5 } },
                        { text: '‚öñÔ∏è Regulate but permit debate', effects: { stability: 5, innovation: 10, culture: 10, economy: 0 } },
                        { text: 'üîá Suppress dangerous ideas', effects: { stability: 15, innovation: -20, culture: -10, economy: 5 } }
                    ]
                }
            );
            
            return templates;
        }

        async function generateEvent(era) {
            try {
                const templates = getEventTemplates(era);
                const template = templates[Math.floor(Math.random() * templates.length)];
                
                // Fetch context from APIs
                const [wikiSummary, quote, historicalFact] = await Promise.all([
                    fetchWikipediaSummary(era.wikiTopic),
                    fetchHistoricalQuote(),
                    fetchHistoricalEvent()
                ]);

                let description = `üìç ${era.period}\n\nüéØ ${template.situation}\n\n`;
                
                if (wikiSummary) {
                    description += `üìö Historical Context: ${wikiSummary.substring(0, 200)}...\n\n`;
                }
                
                if (quote) {
                    description += `üí≠ ${quote}\n\n`;
                }
                
                if (historicalFact) {
                    description += `‚è∞ Real History: ${historicalFact}`;
                }

                return {
                    title: template.title,
                    description: description,
                    choices: template.choices
                };
            } catch (error) {
                console.error('Event generation error:', error);
                // Fallback event
                return {
                    title: `‚öîÔ∏è ${era.name}: Critical Decision`,
                    description: 'Your civilization faces a pivotal moment. Choose wisely.',
                    choices: [
                        { text: '‚ö° Radical reform', effects: { stability: -10, innovation: 15, culture: 0, economy: 5 } },
                        { text: '‚öñÔ∏è Moderate change', effects: { stability: 5, innovation: 5, culture: 5, economy: 5 } },
                        { text: 'üõ°Ô∏è Maintain tradition', effects: { stability: 15, innovation: -10, culture: 10, economy: 0 }forward, technology and ideas flourish` },
                        { text: 'üõ°Ô∏è Preserve traditions and move cautiously', impact: `${era.name} maintains stability, cultural heritage protected` }
                    ]
                };
            } catch (error) {
                console.error('Event generation error:', error);
                return {
                    title: `‚öîÔ∏è ${era.name}: A Moment of Destiny`,
                    description: `The winds of change blow through ${era.name}. As a leader of your people, every decision carries weight. Will you shape a bold new future or honor the wisdom of the past?`,
                    choices: [
                        { text: 'üöÄ Forge a bold new path', impact: 'Rapid transformation reshapes society' },
                        { text: '‚öì Hold steady to proven ways', impact: 'Stable, gradual progress continues' }
                    ]
                };
            }
        }

        async function displayEvent() {
            const era = eras[Math.floor(Math.random() * eras.length)];
            const event = await generateEvent(era);

            gameState.currentYear = era.year;
            gameState.era = era.name;
            gameState.currentEvent = event;

            document.getElementById('apiStatus').textContent = '‚úÖ Real data from Wikipedia, ZenQuotes & History APIs';
            document.getElementById('yearDisplay').textContent = era.year;
            document.getElementById('eraDisplay').textContent = era.name;
            document.getElementById('periodDisplay').textContent = era.period;
            document.getElementById('locationDisplay').textContent = era.name;
            document.getElementById('eventTitle').textContent = event.title;
            document.getElementById('eventDescription').textContent = event.description;
            document.getElementById('consequences').style.display = 'none';

            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            event.choices.forEach((choice) => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.innerHTML = `<strong>${choice.text}</strong><br><span style="font-size: 0.85em; opacity: 0.9;">‚Üí ${choice.impact}</span>`;
                btn.onclick = () => makeChoice(choice);
                choicesContainer.appendChild(btn);
            });
        }

        function makeChoice(choice) {
            gameState.choicesMade++;
            gameState.historyChanged += 10;
            gameState.decisions.push({
                era: gameState.era,
                year: gameState.currentYear,
                choice: choice.text,
                impact: choice.impact
            });

            document.getElementById('choicesDisplay').textContent = gameState.choicesMade;
            const impactPercent = Math.min(gameState.historyChanged, 100);
            document.getElementById('impactDisplay').textContent = impactPercent + '%';

            const consequencesDiv = document.getElementById('consequences');
            let impactMessage = `‚ö° <strong>Immediate Result:</strong> ${choice.impact}`;
            
            // Goal tracking messages
            if (impactPercent === 100) {
                impactMessage += '<br><br>üéâ <strong>TIMELINE REWRITTEN!</strong> You\'ve completely altered the course of history! The world you\'ve created is unrecognizable from the original timeline.';
            } else if (impactPercent >= 70) {
                impactMessage += '<br><br>üåü Major changes accumulating! You\'re approaching a complete timeline rewrite!';
            } else if (impactPercent >= 40) {
                impactMessage += '<br><br>üìà Significant historical shifts detected. Keep going!';
            }
            
            consequencesDiv.innerHTML = impactMessage;
            consequencesDiv.style.display = 'block';

            updateHistoryTimeline();
            setTimeout(() => displayEvent(), 3000);
        }

        function updateHistoryTimeline() {
            const timeline = document.getElementById('historyTimeline');
            timeline.innerHTML = gameState.decisions.map((d) => `
                <div class="timeline-event">
                    <strong>${d.era} (${d.year})</strong><br>
                    ${d.choice}<br>
                    <em>${d.impact}</em>
                </div>
            `).reverse().join('');
        }

        function shareStory() {
            const text = `üé≠ Chronicle Builder:\n\n${gameState.decisions.map(d => `${d.era}: ${d.choice}`).join('\n')}\n\nChoices: ${gameState.choicesMade} | Impact: ${Math.min(gameState.historyChanged, 100)}%`;
            navigator.clipboard.writeText(text).then(() => alert('‚úÖ Copied!')).catch(() => alert('Failed'));
        }

        function resetGame() {
            gameState = { currentYear: 2024, era: 'Modern', choicesMade: 0, historyChanged: 0, decisions: [], currentEvent: null };
            document.getElementById('choicesDisplay').textContent = '0';
            document.getElementById('impactDisplay').textContent = '0%';
            document.getElementById('historyTimeline').innerHTML = '<div style="text-align: center; color: #999;">Your decisions will appear here...</div>';
            displayEvent();
        }

        // Don't auto-start, wait for user to click start button
        // displayEvent() is called by startGame() after user reads intro
    </script>
</body>
</html>
