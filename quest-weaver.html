<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Quest Weaver - Choice Chronicles</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            overflow-x: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            min-height: 100vh;
            padding: clamp(10px, 3vw, 20px);
            transition: background 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2c1a4d 0%, #1a1133 100%);
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: clamp(8px, 2vw, 10px);
        }

        .back-btn, .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: clamp(40px, 8vw, 45px);
            height: clamp(40px, 8vw, 45px);
            cursor: pointer;
            font-size: clamp(1em, 2.5vw, 1.2em);
            transition: all 0.3s ease;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-btn:hover, .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .container {
            max-width: 1000px;
            width: 100%;;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        body.dark-mode .container {
            background: #1a0f2e;
        }

        .game-content {
            padding: clamp(20px, 4vw, 40px);
            min-height: 600px;
        }

        .title {
            color: #8e44ad;
            font-size: clamp(1.8em, 4vw, 2.5em);
            margin-bottom: 10px;
            text-align: center;
            word-wrap: break-word;
        }

        body.dark-mode .title {
            color: #bb8fce;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: clamp(0.9em, 2vw, 1.1em);
            margin-bottom: 30px;
        }

        body.dark-mode .subtitle {
            color: #95a5a6;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 120px), 1fr));
            gap: clamp(10px, 2vw, 15px);
            margin-bottom: 30px;
        }

        .stat-box {
            background: #ecf0f1;
            padding: clamp(12px, 2vw, 15px);
            border-radius: 8px;
            text-align: center;
        }

        body.dark-mode .stat-box {
            background: #2c1a4d;
        }

        .stat-value {
            color: #8e44ad;
            font-size: clamp(1.3em, 3vw, 1.8em);
            font-weight: bold;
        }

        body.dark-mode .stat-value {
            color: #bb8fce;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: clamp(0.8em, 1.8vw, 0.9em);
            margin-top: 5px;
            word-wrap: break-word;
        }

        .quest-display {
            background: linear-gradient(135deg, #f8f4ff 0%, #ede7f6 100%);
            padding: clamp(20px, 4vw, 30px);
            border-radius: 12px;
            margin-bottom: 30px;
            border: 3px solid #8e44ad;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        body.dark-mode .quest-display {
            background: linear-gradient(135deg, #2c1a4d 0%, #1a1133 100%);
            border-color: #bb8fce;
        }

        .quest-title {
            color: #8e44ad;
            font-size: clamp(1.3em, 3vw, 1.6em);
            font-weight: bold;
            margin-bottom: 15px;
            word-wrap: break-word;
        }

        body.dark-mode .quest-title {
            color: #bb8fce;
        }

        .quest-text {
            color: #555;
            line-height: 1.8;
            font-size: clamp(0.95em, 2vw, 1.05em);
            margin-bottom: 15px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        body.dark-mode .quest-text {
            color: #bdc3c7;
        }

        .quest-objective {
            background: rgba(142, 68, 173, 0.1);
            padding: clamp(12px, 2vw, 15px);
            border-radius: 8px;
            border-left: 4px solid #8e44ad;
            margin-top: 15px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        body.dark-mode .quest-objective {
            background: rgba(187, 143, 206, 0.1);
            border-color: #bb8fce;
        }

        .choices-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(min(100%, 250px), 1fr));
            gap: clamp(15px, 3vw, 20px);
            margin-bottom: 30px;
        }

        .choice-card {
            background: white;
            padding: clamp(20px, 3vw, 25px);
            border-radius: 12px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        body.dark-mode .choice-card {
            background: #2c1a4d;
        }

        .choice-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(142, 68, 173, 0.3);
            border-color: #8e44ad;
        }

        .choice-icon {
            font-size: clamp(2.5em, 6vw, 3em);
            text-align: center;
            margin-bottom: 15px;
        }

        .choice-title {
            font-weight: bold;
            color: #8e44ad;
            text-align: center;
            margin-bottom: 12px;
            font-size: clamp(1.1em, 2.5vw, 1.2em);
            word-wrap: break-word;
        }

        body.dark-mode .choice-title {
            color: #bb8fce;
        }

        .choice-description {
            color: #7f8c8d;
            font-size: clamp(0.85em, 1.8vw, 0.9em);
            text-align: center;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        body.dark-mode .choice-description {
            color: #95a5a6;
        }

        .choice-impact {
            margin-top: 12px;
            padding: clamp(8px, 1.5vw, 10px);
            background: #f8f9fa;
            border-radius: 6px;
            font-size: clamp(0.8em, 1.5vw, 0.85em);
            color: #666;
            text-align: center;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        body.dark-mode .choice-impact {
            background: #1a1133;
            color: #999;
        }

        .inventory {
            background: #fff9e6;
            padding: clamp(15px, 3vw, 20px);
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #f39c12;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        body.dark-mode .inventory {
            background: #2c2416;
            border-color: #f39c12;
        }

        .inventory h4 {
            color: #f39c12;
            margin-bottom: 15px;
            font-size: clamp(1em, 2.2vw, 1.2em);
        }

        .inventory-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .inventory-item {
            background: white;
            padding: 8px 15px;
            border-radius: 20px;
            color: #555;
            font-size: clamp(0.85em, 1.8vw, 0.9em);
            border: 2px solid #f39c12;
            word-wrap: break-word;
        }

        body.dark-mode .inventory-item {
            background: #3a2f16;
            color: #d4a76a;
        }

        .action-buttons {
            display: flex;
            gap: clamp(10px, 2vw, 15px);
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: min(150px, 100%);
            padding: clamp(12px, 2vw, 15px);
            background: #8e44ad;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: clamp(0.9em, 2vw, 1em);
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #7d3c98;
            transform: translateY(-2px);
        }

        .btn.danger {
            background: #e74c3c;
        }

        .btn.danger:hover {
            background: #c0392b;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: clamp(25px, 4vw, 40px);
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        body.dark-mode .modal-content {
            background: #1a0f2e;
            color: #e0e0e0;
        }

        .modal-content h2 {
            color: #8e44ad;
            margin-bottom: 20px;
            font-size: clamp(1.5em, 3.5vw, 2em);
        }

        body.dark-mode .modal-content h2 {
            color: #bb8fce;
        }

        @media (max-width: 480px) {
            .choices-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .game-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <button class="back-btn" onclick="window.location.href='index.html'">‚Üê</button>
        <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
    </div>

    <div class="container">
        <div class="game-content">
            <h1 class="title">‚öîÔ∏è Quest Weaver</h1>
            <p class="subtitle">Your choices shape your epic adventure</p>

            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="chapter">1</div>
                    <div class="stat-label">Chapter</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="glory">0</div>
                    <div class="stat-label">Glory</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="health">100</div>
                    <div class="stat-label">Health</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="gold">50</div>
                    <div class="stat-label">Gold</div>
                </div>
            </div>

            <div class="quest-display">
                <div class="quest-title" id="questTitle">The Journey Begins</div>
                <div class="quest-text" id="questText">Loading your adventure...</div>
                <div class="quest-objective" id="questObjective">
                    <strong>üìú Objective:</strong> <span id="objectiveText">Begin your quest</span>
                </div>
            </div>

            <div class="inventory">
                <h4>üéí Inventory</h4>
                <div class="inventory-items" id="inventoryItems">
                    <div class="inventory-item">‚öîÔ∏è Rusty Sword</div>
                </div>
            </div>

            <div class="choices-grid" id="choicesGrid"></div>

            <div class="action-buttons">
                <button class="btn" onclick="viewStats()">üìä View Stats</button>
                <button class="btn danger" onclick="newQuest()">üé≤ New Quest</button>
            </div>
        </div>
    </div>

    <div class="modal" id="resultModal">
        <div class="modal-content">
            <h2 id="resultTitle">Quest Update</h2>
            <p id="resultMessage" style="margin-bottom: 20px; line-height: 1.8;"></p>
            <button class="btn" onclick="closeModal()">Continue</button>
        </div>
    </div>

    <script>
        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('quest-dark-mode', isDark);
            document.querySelector('.theme-toggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        }

        if (localStorage.getItem('quest-dark-mode') === 'true') {
            document.body.classList.add('dark-mode');
            document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
        }

        // Game state
        let gameState = {
            chapter: 1,
            glory: 0,
            health: 100,
            gold: 50,
            inventory: ['‚öîÔ∏è Rusty Sword'],
            completedQuests: 0
        };

        // Quest database - loaded dynamically from JSON
        let quests = [];
        let allQuestsData = null;
        let currentQuestId = 0;

        // Load quests from JSON
        async function loadQuestsData() {
            try {
                const response = await fetch('quest-data.json');
                allQuestsData = await response.json();
                console.log(`Loaded ${allQuestsData.total_quests} quests from database`);
                return true;
            } catch (error) {
                console.error('Failed to load quest data:', error);
                return false;
            }
        }

        // Convert loaded quest to game format
        function convertQuest(rawQuest) {
            // Take the chapters from the quest data
            const chapters = rawQuest.chapters.map(chapter => ({
                chapter: chapter.chapter,
                title: rawQuest.title + ` - Chapter ${chapter.chapter}`,
                text: chapter.text,
                objective: `Continue your quest: ${rawQuest.title}`,
                choices: chapter.choices.map(choice => ({
                    icon: ['‚öîÔ∏è', 'üõ°Ô∏è', 'üó£Ô∏è', 'üí∞', 'üèÉ', 'ü§ù', '‚ú®'][Math.floor(Math.random() * 7)],
                    title: choice.text,
                    description: choice.consequence,
                    impact: `Health: ${choice.health >= 0 ? '+' : ''}${choice.health}, Glory: ${choice.glory >= 0 ? '+' : ''}${choice.glory}, Gold: ${choice.gold >= 0 ? '+' : ''}${choice.gold}`,
                    effects: { 
                        health: choice.health, 
                        glory: choice.glory, 
                        gold: choice.gold,
                        complete: chapter.chapter === rawQuest.chapters.length
                    }
                }))
            }));
            
            return chapters;
        }

        // Legacy quests array (kept for backwards compatibility)
        const legacyQuests = [
            {
                chapter: 1,
                title: "The Bandit Ambush",
                text: "While traveling through the forest, you encounter a group of bandits blocking the road. They demand your gold or your life. You notice they're poorly armed and seem nervous.",
                objective: "Deal with the bandit threat",
                choices: [
                    {
                        icon: "‚öîÔ∏è",
                        title: "Fight",
                        description: "Draw your weapon and attack",
                        impact: "Risk: -30 Health, Reward: +20 Glory, +30 Gold",
                        effects: { health: -30, glory: 20, gold: 30, inventory: "üíé Bandit's Gem" }
                    },
                    {
                        icon: "üí∞",
                        title: "Bribe",
                        description: "Offer them gold to let you pass",
                        impact: "Cost: -25 Gold, Safe passage",
                        effects: { gold: -25, glory: 5 }
                    },
                    {
                        icon: "üó£Ô∏è",
                        title: "Negotiate",
                        description: "Try to talk your way out",
                        impact: "Reward: +10 Glory, +10 Gold",
                        effects: { glory: 10, gold: 10, inventory: "üìú Bandit's Map" }
                    }
                ]
            },
            {
                chapter: 2,
                title: "The Mysterious Merchant",
                text: "In the next town, a mysterious merchant offers you rare items at unusual prices. Some deals seem too good to be true, while others appear overpriced.",
                objective: "Choose your purchase wisely",
                choices: [
                    {
                        icon: "üó°Ô∏è",
                        title: "Magic Sword",
                        description: "An enchanted blade for 40 gold",
                        impact: "Cost: -40 Gold, +15 Glory",
                        effects: { gold: -40, glory: 15, inventory: "üó°Ô∏è Magic Sword" }
                    },
                    {
                        icon: "üß™",
                        title: "Health Potion",
                        description: "Restore your wounds for 20 gold",
                        impact: "Cost: -20 Gold, +40 Health",
                        effects: { gold: -20, health: 40, inventory: "üß™ Health Potion" }
                    },
                    {
                        icon: "üìø",
                        title: "Lucky Charm",
                        description: "A mysterious amulet for 30 gold",
                        impact: "Cost: -30 Gold, Future bonus",
                        effects: { gold: -30, glory: 5, inventory: "üìø Lucky Charm" }
                    }
                ]
            },
            {
                chapter: 3,
                title: "The Dragon's Lair",
                text: "You've tracked the legendary dragon to its mountain lair. Villagers speak of immense treasure inside, but none who entered have returned. As you approach, you hear the dragon's roar echoing through the caverns.",
                objective: "Confront the dragon",
                choices: [
                    {
                        icon: "‚öîÔ∏è",
                        title: "Direct Attack",
                        description: "Charge in with weapons drawn",
                        impact: "High Risk: -50 Health, High Reward: +50 Glory, +100 Gold",
                        effects: { health: -50, glory: 50, gold: 100, inventory: "üêâ Dragon Scale" }
                    },
                    {
                        icon: "üé≠",
                        title: "Sneak In",
                        description: "Try to steal treasure undetected",
                        impact: "Medium Risk: -20 Health, +30 Glory, +60 Gold",
                        effects: { health: -20, glory: 30, gold: 60, inventory: "üíç Dragon Ring" }
                    },
                    {
                        icon: "ü§ù",
                        title: "Negotiate",
                        description: "Attempt to bargain with the dragon",
                        impact: "Low Risk: +20 Glory, +40 Gold",
                        effects: { glory: 20, gold: 40, inventory: "üìñ Ancient Scroll" }
                    }
                ]
            },
            {
                chapter: 4,
                title: "The Cursed Forest",
                text: "Dark magic permeates this ancient forest. The trees whisper warnings, and shadows move on their own. A mysterious voice offers you power in exchange for a price.",
                objective: "Navigate the cursed woods",
                choices: [
                    {
                        icon: "‚ú®",
                        title: "Accept Power",
                        description: "Embrace the dark magic",
                        impact: "Cost: -30 Health, Reward: +40 Glory",
                        effects: { health: -30, glory: 40, inventory: "üåë Dark Crystal" }
                    },
                    {
                        icon: "üõ°Ô∏è",
                        title: "Resist",
                        description: "Fight against the corruption",
                        impact: "Cost: -20 Health, Reward: +25 Glory",
                        effects: { health: -20, glory: 25, inventory: "üõ°Ô∏è Pure Shield" }
                    },
                    {
                        icon: "üèÉ",
                        title: "Flee",
                        description: "Run through the forest quickly",
                        impact: "Safe: +10 Glory",
                        effects: { glory: 10 }
                    }
                ]
            },
            {
                chapter: 5,
                title: "The Final Battle",
                text: "The Dark Lord's fortress looms before you. This is the moment you've been preparing for. Your choices throughout your journey will determine your fate in this ultimate confrontation.",
                objective: "Defeat the Dark Lord",
                choices: [
                    {
                        icon: "‚öîÔ∏è",
                        title: "Heroic Assault",
                        description: "Face the Dark Lord head-on",
                        impact: "Epic Battle: -40 Health, +60 Glory, +80 Gold",
                        effects: { health: -40, glory: 60, gold: 80, inventory: "üëë Victory Crown", complete: true }
                    },
                    {
                        icon: "üó°Ô∏è",
                        title: "Strategic Strike",
                        description: "Use cunning and strategy",
                        impact: "Tactical Win: -25 Health, +50 Glory, +70 Gold",
                        effects: { health: -25, glory: 50, gold: 70, inventory: "üèÜ Hero's Medal", complete: true }
                    },
                    {
                        icon: "ü§ù",
                        title: "Seek Alliance",
                        description: "Rally others to your cause",
                        impact: "United Front: -10 Health, +45 Glory, +60 Gold",
                        effects: { health: -10, glory: 45, gold: 60, inventory: "‚≠ê Unity Banner", complete: true }
                    }
                ]
            }
        ];

        // Load game
        async function loadGame() {
            // Show loading state
            const chapterText = document.getElementById('chapterText');
            if (chapterText) chapterText.textContent = 'Loading quests...';
            
            // Load quest data
            const loaded = await loadQuestsData();
            if (!loaded) {
                if (chapterText) chapterText.textContent = 'Failed to load quests. Please refresh the page.';
                return;
            }
            
            // Load random quest
            if (allQuestsData && allQuestsData.quests) {
                currentQuestId = Math.floor(Math.random() * allQuestsData.quests.length);
                const rawQuest = allQuestsData.quests[currentQuestId];
                quests = convertQuest(rawQuest);
            }
            
            const saved = localStorage.getItem('quest-weaver-state');
            if (saved) {
                gameState = JSON.parse(saved);
            }
            updateDisplay();
            loadQuest();
        }

        function saveGame() {
            localStorage.setItem('quest-weaver-state', JSON.stringify(gameState));
        }

        function updateDisplay() {
            document.getElementById('chapter').textContent = gameState.chapter;
            document.getElementById('glory').textContent = gameState.glory;
            document.getElementById('health').textContent = gameState.health;
            document.getElementById('gold').textContent = gameState.gold;
            
            const inventoryDiv = document.getElementById('inventoryItems');
            inventoryDiv.innerHTML = gameState.inventory.map(item => 
                `<div class="inventory-item">${item}</div>`
            ).join('');
        }

        function loadQuest() {
            const questIndex = Math.min(gameState.chapter - 1, quests.length - 1);
            const quest = quests[questIndex];
            
            document.getElementById('questTitle').textContent = quest.title;
            document.getElementById('questText').textContent = quest.text;
            document.getElementById('objectiveText').textContent = quest.objective;
            
            renderChoices(quest.choices);
        }

        function renderChoices(choices) {
            const grid = document.getElementById('choicesGrid');
            grid.innerHTML = '';
            
            choices.forEach((choice, index) => {
                const card = document.createElement('div');
                card.className = 'choice-card';
                card.onclick = () => makeChoice(choice);
                card.innerHTML = `
                    <div class="choice-icon">${choice.icon}</div>
                    <div class="choice-title">${choice.title}</div>
                    <div class="choice-description">${choice.description}</div>
                    <div class="choice-impact">${choice.impact}</div>
                `;
                grid.appendChild(card);
            });
        }

        function makeChoice(choice) {
            // Apply effects
            gameState.health += choice.effects.health || 0;
            gameState.glory += choice.effects.glory || 0;
            gameState.gold += choice.effects.gold || 0;
            
            // Bounds checking
            gameState.health = Math.max(0, Math.min(100, gameState.health));
            gameState.glory = Math.max(0, gameState.glory);
            gameState.gold = Math.max(0, gameState.gold);
            
            // Add inventory item
            if (choice.effects.inventory) {
                gameState.inventory.push(choice.effects.inventory);
            }
            
            // Check for quest completion
            if (choice.effects.complete) {
                showCompletion();
                return;
            }
            
            // Check for death
            if (gameState.health <= 0) {
                showGameOver();
                return;
            }
            
            // Move to next chapter
            gameState.chapter++;
            gameState.completedQuests++;
            
            updateDisplay();
            saveGame();
            
            showResult(choice);
            
            // Load next quest after delay
            setTimeout(() => {
                if (gameState.chapter <= quests.length) {
                    loadQuest();
                }
            }, 2000);
        }

        function showResult(choice) {
            const modal = document.getElementById('resultModal');
            const title = document.getElementById('resultTitle');
            const message = document.getElementById('resultMessage');
            
            title.textContent = 'üìú Choice Made';
            title.style.color = '#8e44ad';
            
            let effects = [];
            if (choice.effects.health) effects.push(`Health: ${choice.effects.health > 0 ? '+' : ''}${choice.effects.health}`);
            if (choice.effects.glory) effects.push(`Glory: +${choice.effects.glory}`);
            if (choice.effects.gold) effects.push(`Gold: ${choice.effects.gold > 0 ? '+' : ''}${choice.effects.gold}`);
            if (choice.effects.inventory) effects.push(`Found: ${choice.effects.inventory}`);
            
            message.innerHTML = `
                <strong>You chose: ${choice.title}</strong><br><br>
                ${effects.join('<br>')}<br><br>
                <em>Your adventure continues...</em>
            `;
            
            modal.classList.add('show');
        }

        function showCompletion() {
            const modal = document.getElementById('resultModal');
            const title = document.getElementById('resultTitle');
            const message = document.getElementById('resultMessage');
            
            title.textContent = 'üèÜ Quest Complete!';
            title.style.color = '#27ae60';
            
            message.innerHTML = `
                <strong>Congratulations, Hero!</strong><br><br>
                You have completed your epic quest!<br><br>
                <strong>Final Stats:</strong><br>
                Glory: ${gameState.glory}<br>
                Gold: ${gameState.gold}<br>
                Health: ${gameState.health}<br>
                Items Collected: ${gameState.inventory.length}<br><br>
                <em>Your legend will be remembered!</em>
            `;
            
            updateDisplay();
            saveGame();
            modal.classList.add('show');
        }

        function showGameOver() {
            const modal = document.getElementById('resultModal');
            const title = document.getElementById('resultTitle');
            const message = document.getElementById('resultMessage');
            
            title.textContent = 'üíÄ Quest Failed';
            title.style.color = '#e74c3c';
            
            message.innerHTML = `
                <strong>Your health reached zero...</strong><br><br>
                Your journey ends here, but legends never truly die.<br><br>
                <strong>Final Stats:</strong><br>
                Chapter Reached: ${gameState.chapter}<br>
                Glory Earned: ${gameState.glory}<br>
                Gold Collected: ${gameState.gold}<br><br>
                <em>Start a new quest to try again!</em>
            `;
            
            modal.classList.add('show');
        }

        function closeModal() {
            document.getElementById('resultModal').classList.remove('show');
        }

        function viewStats() {
            const modal = document.getElementById('resultModal');
            const title = document.getElementById('resultTitle');
            const message = document.getElementById('resultMessage');
            
            title.textContent = 'üìä Adventure Stats';
            title.style.color = '#8e44ad';
            
            message.innerHTML = `
                <strong>Current Progress:</strong><br><br>
                Chapter: ${gameState.chapter} / ${quests.length}<br>
                Glory: ${gameState.glory}<br>
                Health: ${gameState.health} / 100<br>
                Gold: ${gameState.gold}<br>
                Quests Completed: ${gameState.completedQuests}<br><br>
                <strong>Inventory (${gameState.inventory.length} items):</strong><br>
                ${gameState.inventory.join('<br>')}
            `;
            
            modal.classList.add('show');
        }

        function newQuest() {
            if (confirm('Start a new quest? Current progress will be lost.')) {
                gameState = {
                    chapter: 1,
                    glory: 0,
                    health: 100,
                    gold: 50,
                    inventory: ['‚öîÔ∏è Rusty Sword'],
                    completedQuests: 0
                };
                saveGame();
                updateDisplay();
                loadQuest();
            }
        }

        // Initialize
        loadGame();
    </script>
</body>
</html>
