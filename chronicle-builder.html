<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronicle Builder - Choice Chronicles</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }

        .back-btn, .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
            color: white;
        }

        .back-btn:hover, .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        body.dark-mode .container {
            background: #0f3460;
        }

        .game-content {
            padding: 40px;
            min-height: 600px;
            display: flex;
            flex-direction: column;
        }

        .title {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        body.dark-mode .title {
            color: #e0e0e0;
        }

        .api-status {
            background: #e8f4f8;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            color: #0066cc;
            margin-bottom: 15px;
            text-align: center;
        }

        body.dark-mode .api-status {
            background: #1a2a3a;
            color: #7db8ff;
        }

        .timeline-display {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            min-height: 120px;
        }

        body.dark-mode .timeline-display {
            background: #1a1a2e;
        }

        .era-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .era-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        body.dark-mode .era-item {
            background: #16213e;
            color: #e0e0e0;
        }

        .era-label {
            color: #999;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        body.dark-mode .era-label {
            color: #7db8ff;
        }

        .era-value {
            color: #333;
            font-size: 1.1em;
            font-weight: bold;
        }

        body.dark-mode .era-value {
            color: #fff;
        }

        .event-display {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid #667eea;
            min-height: 150px;
        }

        body.dark-mode .event-display {
            background: #16213e;
            border-color: #9fb3ff;
        }

        .event-title {
            color: #667eea;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        body.dark-mode .event-title {
            color: #9fb3ff;
        }

        .event-description {
            color: #555;
            line-height: 1.8;
            font-size: 1.05em;
        }

        body.dark-mode .event-description {
            color: #b0b0b0;
        }

        .consequences {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            color: #664d03;
            border-left: 4px solid #ffc107;
        }

        body.dark-mode .consequences {
            background: #4a3900;
            color: #ffc107;
        }

        .choices-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .choice-btn {
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-align: left;
        }

        .choice-btn:hover {
            background: #764ba2;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: auto;
        }

        .btn {
            flex: 1;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .btn.secondary {
            background: #6c757d;
        }

        .btn.secondary:hover {
            background: #5a6268;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-box {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        body.dark-mode .stat-box {
            background: #1a1a2e;
        }

        .stat-value {
            color: #667eea;
            font-size: 1.5em;
            font-weight: bold;
        }

        body.dark-mode .stat-value {
            color: #9fb3ff;
        }

        .stat-label {
            color: #999;
            font-size: 0.9em;
            margin-top: 5px;
        }

        body.dark-mode .stat-label {
            color: #7db8ff;
        }

        .history-timeline {
            margin-top: 30px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        body.dark-mode .history-timeline {
            background: #1a1a2e;
        }

        .timeline-event {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #667eea;
            color: #555;
            font-size: 0.95em;
        }

        body.dark-mode .timeline-event {
            background: #16213e;
            color: #b0b0b0;
        }

        @media (max-width: 768px) {
            .game-content {
                padding: 20px;
            }

            .title {
                font-size: 1.8em;
            }

            .era-info {
                grid-template-columns: 1fr;
            }

            .choices-grid {
                grid-template-columns: 1fr;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header-bar">
        <button class="back-btn" onclick="goBack()" title="Back to Hub">‚Üê</button>
        <h1 style="color: white; flex: 1; text-align: center; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">üìñ Chronicle Builder</h1>
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">üåô</button>
    </div>

    <div class="container">
        <div class="game-content">
            <!-- API Status -->
            <div class="api-status" id="apiStatus">üîÑ Loading from APIs...</div>

            <!-- Statistics -->
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="yearDisplay">2024</div>
                    <div class="stat-label">Year</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="eraDisplay">Modern</div>
                    <div class="stat-label">Era</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="choicesDisplay">0</div>
                    <div class="stat-label">Choices Made</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="impactDisplay">0%</div>
                    <div class="stat-label">History Changed</div>
                </div>
            </div>

            <!-- Timeline Era Information -->
            <div class="timeline-display">
                <div class="era-info">
                    <div class="era-item">
                        <div class="era-label">‚è∞ Historical Period</div>
                        <div class="era-value" id="periodDisplay">Loading...</div>
                    </div>
                    <div class="era-item">
                        <div class="era-label">üåç Location</div>
                        <div class="era-value" id="locationDisplay">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Event Display -->
            <div class="event-display">
                <div class="event-title">üìú Historical Event</div>
                <div class="event-description" id="eventDescription">Loading event...</div>
                <div class="consequences" id="consequences" style="display: none;"></div>
            </div>

            <!-- Choices -->
            <div style="margin-bottom: 20px;">
                <h3 style="color: #333; margin-bottom: 15px;">Your Decision:</h3>
                <div class="choices-grid" id="choicesContainer">
                    <div style="text-align: center; color: #999;">Loading choices...</div>
                </div>
            </div>

            <!-- History Timeline -->
            <div class="history-timeline" id="historyTimeline">
                <div style="text-align: center; color: #999;">Your decisions will appear here...</div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn secondary" onclick="resetGame()">Reset Game</button>
                <button class="btn" onclick="shareStory()">Share Story</button>
            </div>
        </div>
    </div>

    <script>
        // Theme toggle
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('dark-mode', isDark);
            document.querySelector('.theme-toggle').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        }

        if (localStorage.getItem('dark-mode') === 'true') {
            document.body.classList.add('dark-mode');
            document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
        }

        function goBack() {
            window.location.href = 'index.html';
        }

        // Game State
        let gameState = {
            currentYear: 2024,
            era: 'Modern',
            choicesMade: 0,
            historyChanged: 0,
            decisions: [],
            currentEvent: null
        };

        // Historical Periods with API topics
        const eras = [
            { name: 'Ancient Egypt', year: 1500, period: '3000 BCE - 30 BCE', wikiTopic: 'Ancient Egypt' },
            { name: 'Classical Greece', year: 1, period: '800 BCE - 146 BCE', wikiTopic: 'Ancient Greece' },
            { name: 'Roman Empire', year: 100, period: '27 BCE - 476 CE', wikiTopic: 'Roman Empire' },
            { name: 'Medieval Times', year: 1000, period: '500 CE - 1500 CE', wikiTopic: 'Middle Ages' },
            { name: 'Renaissance', year: 1400, period: '1300 - 1600', wikiTopic: 'Renaissance' },
            { name: 'Age of Exploration', year: 1500, period: '1400 - 1700', wikiTopic: 'Age of Exploration' },
            { name: 'Industrial Revolution', year: 1750, period: '1760 - 1840', wikiTopic: 'Industrial Revolution' },
            { name: 'Victorian Era', year: 1850, period: '1837 - 1901', wikiTopic: 'Victorian era' },
            { name: 'Roaring Twenties', year: 1920, period: '1920 - 1929', wikiTopic: 'Roaring Twenties' },
            { name: 'World War II', year: 1940, period: '1939 - 1945', wikiTopic: 'World War II' },
            { name: 'Cold War', year: 1960, period: '1945 - 1991', wikiTopic: 'Cold War' },
            { name: 'Digital Age', year: 2000, period: '2000 - Present', wikiTopic: 'Digital Revolution' },
            { name: 'Modern Era', year: 2024, period: '2020 - Present', wikiTopic: 'Information Age' }
        ];

        // API Functions
        async function fetchWikipediaSummary(topic) {
            try {
                const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(topic)}`);
                if (!response.ok) throw new Error('Wikipedia fetch failed');
                const data = await response.json();
                return data.extract || null;
            } catch (error) {
                console.log('Wikipedia API unavailable');
                return null;
            }
        }

        async function fetchHistoricalQuote() {
            try {
                // Try ZenQuotes API first
                const response = await fetch('https://zenquotes.io/api/random');
                if (!response.ok) throw new Error('ZenQuotes failed');
                const data = await response.json();
                if (data && data[0]) {
                    return `"${data[0].q}" - ${data[0].a}`;
                }
            } catch (error) {
                console.log('ZenQuotes unavailable, trying Advice Slip...');
            }
            
            try {
                // Fallback to Advice Slip API
                const response = await fetch('https://api.adviceslip.com/advice');
                if (!response.ok) throw new Error('Advice Slip failed');
                const data = await response.json();
                if (data && data.slip) {
                    return `"${data.slip.advice}" - Wisdom`;
                }
            } catch (error) {
                console.log('Advice Slip unavailable, trying Game of Thrones...');
            }

            try {
                // Fallback to Game of Thrones Quotes API
                const response = await fetch('https://api.gameofthronesquotes.xyz/v1/random');
                if (!response.ok) throw new Error('GOT Quotes failed');
                const data = await response.json();
                if (data && data.sentence) {
                    return `"${data.sentence}" - ${data.character.name}`;
                }
            } catch (error) {
                console.log('All quote APIs unavailable');
                return null;
            }
        }

        async function fetchHistoricalEvent() {
            try {
                const response = await fetch('https://history.muffinlabs.com/date');
                if (!response.ok) throw new Error('History API failed');
                const data = await response.json();
                if (data.data && data.data.Events && data.data.Events.length > 0) {
                    const randomEvent = data.data.Events[Math.floor(Math.random() * Math.min(5, data.data.Events.length))];
                    return `In ${randomEvent.year}: ${randomEvent.text}`;
                }
                return null;
            } catch (error) {
                console.log('History API unavailable');
                return null;
            }
        }

        async function generateEvent(era) {
            try {
                const [wikiSummary, quote, historicalFact] = await Promise.all([
                    fetchWikipediaSummary(era.wikiTopic),
                    fetchHistoricalQuote(),
                    fetchHistoricalEvent()
                ]);

                let description = '';
                
                // Use Wikipedia summary as primary source
                if (wikiSummary) {
                    description = wikiSummary.substring(0, 280);
                } else if (historicalFact) {
                    description = `${historicalFact}\n\nAs a leader in ${era.name}, how would you respond to such momentous events?`;
                } else {
                    description = `You are a leader in ${era.name}. Historical forces are in motion, requiring your guidance.`;
                }

                // Add quote for flavor if available
                if (quote) {
                    description += `\n\nüí≠ ${quote}`;
                }

                return {
                    title: `${era.name} - Critical Decision`,
                    description: description,
                    choices: [
                        { text: 'Embrace progress and change', impact: 'Society advances with innovation' },
                        { text: 'Preserve tradition and stability', impact: 'Cultural heritage is maintained' }
                    ]
                };
            } catch (error) {
                console.error('Event generation error:', error);
                return {
                    title: `${era.name} - Historical Crossroads`,
                    description: `The winds of change blow through ${era.name}. Your decisions will shape the future.`,
                    choices: [
                        { text: 'Forge ahead boldly', impact: 'Rapid transformation occurs' },
                        { text: 'Proceed with caution', impact: 'Stable progress is maintained' }
                    ]
                };
            }
        }

        async function displayEvent() {
            const era = eras[Math.floor(Math.random() * eras.length)];
            const event = await generateEvent(era);

            gameState.currentYear = era.year;
            gameState.era = era.name;
            gameState.currentEvent = event;

            document.getElementById('apiStatus').textContent = '‚úÖ Real data from Wikipedia, ZenQuotes & History APIs';
            document.getElementById('yearDisplay').textContent = era.year;
            document.getElementById('eraDisplay').textContent = era.name;
            document.getElementById('periodDisplay').textContent = era.period;
            document.getElementById('locationDisplay').textContent = era.name;
            document.getElementById('eventDescription').textContent = event.description;
            document.getElementById('consequences').style.display = 'none';

            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            event.choices.forEach((choice) => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.innerHTML = `<strong>${choice.text}</strong><br><span style="font-size: 0.85em; opacity: 0.9;">‚Üí ${choice.impact}</span>`;
                btn.onclick = () => makeChoice(choice);
                choicesContainer.appendChild(btn);
            });
        }

        function makeChoice(choice) {
            gameState.choicesMade++;
            gameState.historyChanged += 10;
            gameState.decisions.push({
                era: gameState.era,
                year: gameState.currentYear,
                choice: choice.text,
                impact: choice.impact
            });

            document.getElementById('choicesDisplay').textContent = gameState.choicesMade;
            document.getElementById('impactDisplay').textContent = Math.min(gameState.historyChanged, 100) + '%';

            const consequencesDiv = document.getElementById('consequences');
            consequencesDiv.innerHTML = `‚ö° <strong>Timeline Impact:</strong> ${choice.impact}`;
            consequencesDiv.style.display = 'block';

            updateHistoryTimeline();
            setTimeout(() => displayEvent(), 2000);
        }

        function updateHistoryTimeline() {
            const timeline = document.getElementById('historyTimeline');
            timeline.innerHTML = gameState.decisions.map((d) => `
                <div class="timeline-event">
                    <strong>${d.era} (${d.year})</strong><br>
                    ${d.choice}<br>
                    <em>${d.impact}</em>
                </div>
            `).reverse().join('');
        }

        function shareStory() {
            const text = `üé≠ Chronicle Builder:\n\n${gameState.decisions.map(d => `${d.era}: ${d.choice}`).join('\n')}\n\nChoices: ${gameState.choicesMade} | Impact: ${Math.min(gameState.historyChanged, 100)}%`;
            navigator.clipboard.writeText(text).then(() => alert('‚úÖ Copied!')).catch(() => alert('Failed'));
        }

        function resetGame() {
            gameState = { currentYear: 2024, era: 'Modern', choicesMade: 0, historyChanged: 0, decisions: [], currentEvent: null };
            document.getElementById('choicesDisplay').textContent = '0';
            document.getElementById('impactDisplay').textContent = '0%';
            document.getElementById('historyTimeline').innerHTML = '<div style="text-align: center; color: #999;">Your decisions will appear here...</div>';
            displayEvent();
        }

        displayEvent();
    </script>
</body>
</html>
